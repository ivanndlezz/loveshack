<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reservation Pricing Calculator</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      rel="icon"
      href="https://www.loveshackcruises.com/wp-content/uploads/2020/06/Recurso-5.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="https://www.loveshackcruises.com/wp-content/uploads/2020/06/Recurso-5.png"
    />
    <meta
      name="msapplication-TileImage"
      content="https://www.loveshackcruises.com/wp-content/uploads/2020/06/Recurso-5.png"
    />
  </head>
  <body>
    <div class="calculator-container">
      <!-- Header -->
      <header class="calculator-header">
        <h1>Reservation Pricing</h1>
        <p class="subtitle">
          Calculate final prices with sources and discounts
        </p>
      </header>

      <!-- Form Card -->
      <div class="form-card">
        <!-- Sticky Quick Fields -->
        <div class="sticky-quick-fields">
          <div class="sticky-field sticky-field-slider">
            <label for="duration"
              >Duration: <span id="durationValue">3</span>h</label
            >
            <div class="slider-container">
              <input
                type="range"
                id="duration"
                data-field="duration"
                min="2"
                max="8"
                step="1"
                value="3"
                class="form-slider"
                list="durationOptions"
              />
              <datalist id="durationOptions">
                <option value="2" label="2h"></option>
                <option value="3" label="3h"></option>
                <option value="4" label="4h"></option>
                <option value="5" label="5h"></option>
                <option value="6" label="6h"></option>
                <option value="7" label="7h"></option>
                <option value="8" label="8h"></option>
              </datalist>
            </div>
          </div>
          <div class="sticky-field">
            <label for="passengers">Passengers</label>
            <input
              type="number"
              id="passengers"
              data-field="passengers"
              min="1"
              max="50"
              value="14"
              class="form-input"
            />
          </div>
        </div>

        <!-- Trip Details Section -->
        <section class="form-section">
          <h2 class="section-title">
            <span class="icon">üö¢</span>
            Trip Details
          </h2>

          <div class="form-grid">
            <!-- Tour Type Tab Group -->
            <div class="form-group full-width">
              <label>Tour Type</label>
              <div class="tab-group" id="tourTypeTab">
                <button
                  class="tab-option"
                  data-value="Bay Trip"
                  onclick="selectTourType('Bay Trip', this)"
                >
                  Bay
                </button>
                <button
                  class="tab-option"
                  data-value="Whale Watching"
                  onclick="selectTourType('Whale Watching', this)"
                >
                  Whale
                </button>
                <button
                  class="tab-option"
                  data-value="Snorkeling Tour"
                  onclick="selectTourType('Snorkeling Tour', this)"
                >
                  Snorkel
                </button>
                <button
                  class="tab-option"
                  data-value="Sunset Cruise"
                  onclick="selectTourType('Sunset Cruise', this)"
                >
                  Sunset
                </button>
                <button
                  class="tab-option"
                  data-value="Fishing"
                  onclick="selectTourType('Fishing', this)"
                >
                  Fishing
                </button>
              </div>
              <input
                type="hidden"
                id="tourType"
                data-field="tourType"
                value=""
              />
            </div>

            <!-- Pricing Type Tab Group -->
            <div class="form-group">
              <label>Pricing Type</label>
              <div class="tab-group" id="pricingTypeTab">
                <button
                  class="tab-option active"
                  data-value="regular"
                  onclick="selectPricingType('regular', this)"
                >
                  Regular<br /><small>$600/hr</small>
                </button>
                <button
                  class="tab-option"
                  data-value="snack"
                  onclick="selectPricingType('snack', this)"
                >
                  Snack<br /><small>$450/hr</small>
                </button>
              </div>
              <input
                type="hidden"
                id="pricingType"
                data-field="pricingType"
                value="regular"
              />
            </div>

            <!-- Source Custom Select with Inline Search -->
            <div class="form-group">
              <label>Booking Source</label>
              <div
                class="custom-select custom-select-searchable"
                id="sourceSelect"
              >
                <input
                  type="hidden"
                  id="source"
                  data-field="source"
                  value="direct"
                />
                <div class="custom-select-trigger">
                  <input
                    type="text"
                    class="custom-select-input"
                    id="sourceInput"
                    placeholder="Search sources..."
                    oninput="handleSelectSearch('source', this.value)"
                    onfocus="openSelectDropdown('sourceSelect')"
                  />
                  <button
                    class="custom-select-toggle"
                    onclick="toggleSelect('sourceSelect')"
                  >
                    <svg
                      width="12"
                      height="12"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                </div>
                <div class="custom-select-dropdown">
                  <div class="custom-select-options" id="sourceOptions"></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Extras Section -->
        <section class="form-section">
          <h2 class="section-title">
            <span class="icon">‚ú®</span>
            Extra Services
          </h2>

          <div class="form-grid">
            <div class="form-group">
              <label for="fishingLicenses">Fishing Licenses</label>
              <input
                type="number"
                id="fishingLicenses"
                data-field="fishingLicenses"
                min="0"
                value="0"
                class="form-input"
              />
              <span class="form-hint">$22 each (Fishing tours only)</span>
            </div>

            <div class="form-group full-width">
              <label for="extrasAmount">Other Extras Amount</label>
              <div class="input-with-prefix">
                <span class="prefix">$</span>
                <input
                  type="number"
                  id="extrasAmount"
                  data-field="extrasAmount"
                  min="0"
                  step="0.01"
                  value="0"
                  class="form-input"
                />
              </div>
            </div>
          </div>
        </section>

        <!-- Reprice Section -->
        <section class="form-section">
          <h2 class="section-title">
            <span class="icon">üè∑Ô∏è</span>
            Reprice / Discount
          </h2>

          <div class="form-grid">
            <!-- Reprice Type Tab Group -->
            <div class="form-group">
              <label>Discount Type</label>
              <div class="tab-group" id="repriceTypeTab">
                <button
                  class="tab-option active"
                  data-value=""
                  onclick="selectRepriceType('', this)"
                >
                  None
                </button>
                <button
                  class="tab-option"
                  data-value="%"
                  onclick="selectRepriceType('%', this)"
                >
                  %
                </button>
                <button
                  class="tab-option"
                  data-value="$"
                  onclick="selectRepriceType('$', this)"
                >
                  $
                </button>
              </div>
              <input
                type="hidden"
                id="repriceType"
                data-field="repriceType"
                value=""
              />
            </div>

            <div class="form-group">
              <label for="repriceDiscount">Discount Value</label>
              <div class="input-with-prefix">
                <span class="prefix" id="discountPrefix">$</span>
                <input
                  type="number"
                  id="repriceDiscount"
                  data-field="repriceDiscount"
                  min="0"
                  step="0.01"
                  value=""
                  class="form-input"
                  placeholder="0"
                />
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Pricing Summary Card -->
      <div class="summary-card">
        <h2 class="summary-title">Pricing Summary</h2>

        <div class="summary-breakdown">
          <div class="summary-row">
            <span>Total Passengers</span>
            <span id="totalPassengers">14</span>
          </div>

          <div class="summary-row">
            <span
              >Base Trip (<span id="summaryDuration">3</span>h √ó
              <span id="summaryRate">$600</span>)</span
            >
            <span id="baseTripPrice">$1,800</span>
          </div>

          <div class="summary-row" id="extraPassengersRow">
            <span>Extra Passengers (<span id="extraCount">0</span>)</span>
            <span id="extraPassengerPrice">$0</span>
          </div>

          <div class="summary-row" id="extrasRow">
            <span>Extra Services</span>
            <span id="extrasPrice">$0</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row subtotal">
            <span>Subtotal</span>
            <span id="subtotalPrice">$1,800</span>
          </div>

          <div
            class="summary-row discount"
            id="discountRow"
            style="display: none"
          >
            <span>Discount (<span id="discountType">%</span>)</span>
            <span id="discountAmount">-$0</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row final">
            <span>Business Receives</span>
            <span id="businessPrice">$1,800.00</span>
          </div>

          <div class="summary-row fee" id="feeRow" style="display: none">
            <span><span id="feeSource">Source</span> Fee</span>
            <span id="feeAmount">$0</span>
          </div>

          <div class="summary-row total">
            <span>Customer Pays</span>
            <span id="customerPrice">$1,800.00</span>
          </div>
        </div>

        <!-- Fee Notice for Sources with Fees -->
        <div class="fee-notice" id="feeNotice" style="display: none">
          <span class="notice-icon">‚ÑπÔ∏è</span>
          <span id="feeNoticeText">Get My Boat charges 11.5% fee</span>
        </div>
      </div>

      <!-- Sticky Bottom Bar -->
      <div class="sticky-bottom-bar">
        <div class="sticky-bottom-item">
          <span class="sticky-bottom-icon">üë•</span>
          <span id="stickyPassengers">14</span>
          <span class="sticky-bottom-label">passengers</span>
        </div>
        <div class="sticky-bottom-divider"></div>
        <div class="sticky-bottom-item">
          <span class="sticky-bottom-icon">‚è±Ô∏è</span>
          <span id="stickyDuration">3</span>
          <span class="sticky-bottom-label">hours</span>
        </div>
        <div class="sticky-bottom-divider"></div>
        <div class="sticky-bottom-item sticky-bottom-total">
          <span id="stickyBusinessPrice">$1,800.00</span>
          <span class="sticky-bottom-label">business</span>
        </div>
        <div class="sticky-bottom-divider"></div>
        <div class="sticky-bottom-item sticky-bottom-total">
          <span id="stickyCustomerPrice">$1,800.00</span>
          <span class="sticky-bottom-label">customer</span>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/pricing-rules.js"></script>
    <script src="js/pricing-calculator.js"></script>
    <script src="js/app.js"></script>

    <!-- Custom Select Component Script -->
    <script>
      // Tab Selection Functions
      function selectTourType(value, button) {
        const hiddenInput = document.getElementById("tourType");
        hiddenInput.value = value;

        // Update active state
        document.querySelectorAll("#tourTypeTab .tab-option").forEach((btn) => {
          btn.classList.remove("active");
        });
        button.classList.add("active");

        // Trigger change event
        hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));
      }

      function selectPricingType(value, button) {
        const hiddenInput = document.getElementById("pricingType");
        hiddenInput.value = value;

        // Update active state
        document
          .querySelectorAll("#pricingTypeTab .tab-option")
          .forEach((btn) => {
            btn.classList.remove("active");
          });
        button.classList.add("active");

        // Trigger change event
        hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));
      }

      function selectRepriceType(value, button) {
        const hiddenInput = document.getElementById("repriceType");
        hiddenInput.value = value;

        // Update active state
        document
          .querySelectorAll("#repriceTypeTab .tab-option")
          .forEach((btn) => {
            btn.classList.remove("active");
          });
        button.classList.add("active");

        // Update prefix
        const discountPrefix = document.getElementById("discountPrefix");
        if (value === "%") {
          discountPrefix.textContent = "%";
          document.getElementById("repriceDiscount").placeholder = "10";
        } else if (value === "$") {
          discountPrefix.textContent = "$";
          document.getElementById("repriceDiscount").placeholder = "0";
        } else {
          discountPrefix.textContent = "$";
          document.getElementById("repriceDiscount").placeholder = "0";
        }

        // Trigger change event
        hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));
      }

      // Custom Select Functions
      function toggleSelect(selectId) {
        const select = document.getElementById(selectId);
        const isOpen = select.classList.contains("open");

        // Close all selects
        document.querySelectorAll(".custom-select").forEach((s) => {
          s.classList.remove("open");
          s.querySelector(".custom-select-dropdown").classList.remove("open");
        });

        if (!isOpen) {
          select.classList.add("open");
          select.querySelector(".custom-select-dropdown").classList.add("open");
        }
      }

      function openSelectDropdown(selectId) {
        const select = document.getElementById(selectId);
        if (!select.classList.contains("open")) {
          select.classList.add("open");
          select.querySelector(".custom-select-dropdown").classList.add("open");
        }
      }

      function handleSelectSearch(fieldType, searchTerm) {
        const term = searchTerm.toLowerCase().trim();
        const optionsId = fieldType + "Options";
        const options = document.getElementById(optionsId);

        if (!options) return;

        const items = options.querySelectorAll(".custom-select-option");

        items.forEach((item) => {
          const text = item.textContent.toLowerCase();
          if (text.includes(term) || term === "") {
            item.style.display = "flex";
          } else {
            item.style.display = "none";
          }
        });
      }

      function selectOptionValue(fieldType, value, displayText) {
        const hiddenInput = document.getElementById(fieldType);
        const inputField = document.getElementById(fieldType + "Input");

        hiddenInput.value = value;
        inputField.value = displayText;

        // Trigger change event
        hiddenInput.dispatchEvent(new Event("change", { bubbles: true }));

        // Close all dropdowns
        document.querySelectorAll(".custom-select").forEach((s) => {
          s.classList.remove("open");
          s.querySelector(".custom-select-dropdown").classList.remove("open");
        });
      }

      // Close dropdowns when clicking outside
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".custom-select")) {
          document.querySelectorAll(".custom-select").forEach((select) => {
            select.classList.remove("open");
            select
              .querySelector(".custom-select-dropdown")
              .classList.remove("open");
          });
        }
      });
    </script>
  </body>
</html>
